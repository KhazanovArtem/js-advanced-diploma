(()=>{"use strict";var e={1402:(e,t,a)=>{a.d(t,{Z:()=>Ze});var n=a(8081),i=a.n(n),s=a(3645),r=a.n(s),l=a(1667),o=a.n(l),c=new URL(a(3523),a.b),h=new URL(a(8349),a.b),d=new URL(a(137),a.b),m=new URL(a(2024),a.b),p=new URL(a(3177),a.b),u=new URL(a(5324),a.b),g=new URL(a(8896),a.b),f=new URL(a(1034),a.b),b=new URL(a(9980),a.b),v=new URL(a(9265),a.b),y=new URL(a(2830),a.b),w=new URL(a(3303),a.b),S=new URL(a(1227),a.b),x=new URL(a(815),a.b),C=new URL(a(4263),a.b),L=new URL(a(5350),a.b),k=new URL(a(1692),a.b),E=new URL(a(4832),a.b),M=new URL(a(6639),a.b),P=new URL(a(1530),a.b),$=new URL(a(2109),a.b),U=new URL(a(4609),a.b),R=new URL(a(3967),a.b),T=new URL(a(5491),a.b),G=new URL(a(9754),a.b),D=new URL(a(5237),a.b),z=new URL(a(2608),a.b),A=new URL(a(1947),a.b),I=new URL(a(6266),a.b),O=new URL(a(8589),a.b),N=new URL(a(8757),a.b),B=new URL(a(2110),a.b),j=new URL(a(3636),a.b),q=new URL(a(8299),a.b),H=new URL(a(6136),a.b),Z=new URL(a(9618),a.b),_=new URL(a(3010),a.b),F=new URL(a(9937),a.b),J=new URL(a(9030),a.b),Q=new URL(a(7345),a.b),W=new URL(a(5195),a.b),K=new URL(a(5153),a.b),V=new URL(a(8269),a.b),X=new URL(a(5316),a.b),Y=r()(i()),ee=o()(c),te=o()(h),ae=o()(d),ne=o()(m),ie=o()(p),se=o()(u),re=o()(g),le=o()(f),oe=o()(b),ce=o()(v),he=o()(y),de=o()(w),me=o()(S),pe=o()(x),ue=o()(C),ge=o()(L),fe=o()(k),be=o()(E),ve=o()(M),ye=o()(P),we=o()($),Se=o()(U),xe=o()(R),Ce=o()(T),Le=o()(G),ke=o()(D),Ee=o()(z),Me=o()(A),Pe=o()(I),$e=o()(O),Ue=o()(N),Re=o()(B),Te=o()(j),Ge=o()(q),De=o()(H),ze=o()(Z),Ae=o()(_),Ie=o()(F),Oe=o()(J),Ne=o()(Q),Be=o()(W),je=o()(K),qe=o()(V),He=o()(X);Y.push([e.id,`:root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url(${ee});\n  --map-tile-top-url: url(${te});\n  --map-tile-top-right-url: url(${ae});\n  --map-tile-bottom-left-url: url(${ne});\n  --map-tile-bottom-url: url(${ie});\n  --map-tile-bottom-right-url: url(${se});\n  --map-tile-left-url: url(${re});\n  --map-tile-right-url: url(${le});\n  --map-tile-center-url: url(${oe});\n}\n\n.board.desert {\n  --map-tile-top-left-url: url(${ce});\n  --map-tile-top-url: url(${he});\n  --map-tile-top-right-url: url(${de});\n  --map-tile-bottom-left-url: url(${me});\n  --map-tile-bottom-url: url(${pe});\n  --map-tile-bottom-right-url: url(${ue});\n  --map-tile-left-url: url(${ge});\n  --map-tile-right-url: url(${fe});\n  --map-tile-center-url: url(${be});\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url(${ve});\n  --map-tile-top-url: url(${ye});\n  --map-tile-top-right-url: url(${we});\n  --map-tile-bottom-left-url: url(${Se});\n  --map-tile-bottom-url: url(${xe});\n  --map-tile-bottom-right-url: url(${Ce});\n  --map-tile-left-url: url(${Le});\n  --map-tile-right-url: url(${ke});\n  --map-tile-center-url: url(${Ee});\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url(${Me});\n  --map-tile-top-url: url(${Pe});\n  --map-tile-top-right-url: url(${$e});\n  --map-tile-bottom-left-url: url(${Ue});\n  --map-tile-bottom-url: url(${Re});\n  --map-tile-bottom-right-url: url(${Te});\n  --map-tile-left-url: url(${Ge});\n  --map-tile-right-url: url(${De});\n  --map-tile-center-url: url(${ze});\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 99;\n}\n\n.character.generic {\n  background: url(${Ae});\n}\n\n.character.bowman {\n  background: url(${Ie});\n}\n\n.character.daemon {\n  background: url(${Oe});\n}\n\n.character.magician {\n  background: url(${Ne});\n}\n\n.character.swordsman {\n  background: url(${Be});\n}\n\n.character.undead {\n  background: url(${je});\n}\n\n.character.vampire {\n  background: url(${qe});\n}\n\n.character.zombie {\n  background: url(${He});\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n.damage {\n  position: absolute;\n  width: var(--cell-size);\n  text-align: center;\n  z-index: 999;\n  color: #f00;\n  font-weight: bold;\n  animation: 500ms fade ease-out;\n}\n\n@keyframes fade {\n  from {\n    opacity: 0;\n    top: calc(var(--cell-size) * 0.5);\n    font-size: 1rem;\n  }\n  to {\n    opacity: 1;\n    top: -20px;\n    font-size: 1.5rem;\n  }\n}\n`,""]);const Ze=Y},3645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var a="",n=void 0!==t[5];return t[4]&&(a+="@supports (".concat(t[4],") {")),t[2]&&(a+="@media ".concat(t[2]," {")),n&&(a+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),a+=e(t),n&&(a+="}"),t[2]&&(a+="}"),t[4]&&(a+="}"),a})).join("")},t.i=function(e,a,n,i,s){"string"==typeof e&&(e=[[null,e,void 0]]);var r={};if(n)for(var l=0;l<this.length;l++){var o=this[l][0];null!=o&&(r[o]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);n&&r[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),a&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=a):h[2]=a),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),t.push(h))}},t}},1667:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},8081:e=>{e.exports=function(e){return e[1]}},3379:e=>{var t=[];function a(e){for(var a=-1,n=0;n<t.length;n++)if(t[n].identifier===e){a=n;break}return a}function n(e,n){for(var s={},r=[],l=0;l<e.length;l++){var o=e[l],c=n.base?o[0]+n.base:o[0],h=s[c]||0,d="".concat(c," ").concat(h);s[c]=h+1;var m=a(d),p={css:o[1],media:o[2],sourceMap:o[3],supports:o[4],layer:o[5]};if(-1!==m)t[m].references++,t[m].updater(p);else{var u=i(p,n);n.byIndex=l,t.splice(l,0,{identifier:d,updater:u,references:1})}r.push(d)}return r}function i(e,t){var a=t.domAPI(t);return a.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;a.update(e=t)}else a.remove()}}e.exports=function(e,i){var s=n(e=e||[],i=i||{});return function(e){e=e||[];for(var r=0;r<s.length;r++){var l=a(s[r]);t[l].references--}for(var o=n(e,i),c=0;c<s.length;c++){var h=a(s[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}s=o}}},569:e=>{var t={};e.exports=function(e,a){var n=function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(e){a=null}t[e]=a}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(a)}},9216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},3565:(e,t,a)=>{e.exports=function(e){var t=a.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(a){!function(e,t,a){var n="";a.supports&&(n+="@supports (".concat(a.supports,") {")),a.media&&(n+="@media ".concat(a.media," {"));var i=void 0!==a.layer;i&&(n+="@layer".concat(a.layer.length>0?" ".concat(a.layer):""," {")),n+=a.css,i&&(n+="}"),a.media&&(n+="}"),a.supports&&(n+="}");var s=a.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,a)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},4589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},4609:(e,t,a)=>{e.exports=a.p+"img/b27323cf850ed820855c.png"},5491:(e,t,a)=>{e.exports=a.p+"img/ac9d74f57639792774bc.png"},3967:(e,t,a)=>{e.exports=a.p+"img/63aae58e4690953a3857.png"},2608:(e,t,a)=>{e.exports=a.p+"img/246277b8ca590816b3e8.png"},9754:(e,t,a)=>{e.exports=a.p+"img/3d9503e0a850fda86f82.png"},5237:(e,t,a)=>{e.exports=a.p+"img/22e7c5ede3f747cbe27a.png"},6639:(e,t,a)=>{e.exports=a.p+"img/eab6a2cc5e89a4dd8e3f.png"},2109:(e,t,a)=>{e.exports=a.p+"img/d31d84c693f649766aee.png"},1530:(e,t,a)=>{e.exports=a.p+"img/e0aa3daf6d08c62c96d9.png"},9937:(e,t,a)=>{e.exports=a.p+"img/cec542854b228e61547a.png"},9030:(e,t,a)=>{e.exports=a.p+"img/cf170a9fea1051b7424a.png"},3010:(e,t,a)=>{e.exports=a.p+"img/0a77fc47d727eab6fd39.png"},7345:(e,t,a)=>{e.exports=a.p+"img/c0fa2b75539f94144dc4.png"},5195:(e,t,a)=>{e.exports=a.p+"img/2007ec00c1d9f997e704.png"},5153:(e,t,a)=>{e.exports=a.p+"img/f5c75398bcb5931f9f3c.png"},8269:(e,t,a)=>{e.exports=a.p+"img/bf0ed0dca1d1e6091d42.png"},5316:(e,t,a)=>{e.exports=a.p+"img/296dfeac15e2377fc1dc.png"},1227:(e,t,a)=>{e.exports=a.p+"img/13edb269e39172ddd74f.png"},4263:(e,t,a)=>{e.exports=a.p+"img/5cf9c17d6a1ea7106a6c.png"},815:(e,t,a)=>{e.exports=a.p+"img/f1703771380a9959d979.png"},4832:(e,t,a)=>{e.exports=a.p+"img/51e2a5de56bd631452fe.png"},5350:(e,t,a)=>{e.exports=a.p+"img/eb1f6e4f87b977012684.png"},1692:(e,t,a)=>{e.exports=a.p+"img/2c19971f327b288278bb.png"},9265:(e,t,a)=>{e.exports=a.p+"img/258d884122fabfc2f312.png"},3303:(e,t,a)=>{e.exports=a.p+"img/2f1e1970c2c20cf3a8d5.png"},2830:(e,t,a)=>{e.exports=a.p+"img/dc3f97e7bbcd5ea1ded9.png"},8757:(e,t,a)=>{e.exports=a.p+"img/1d70f1dab2dd418c3612.png"},3636:(e,t,a)=>{e.exports=a.p+"img/6bacb8e25ed9ecf726bf.png"},2110:(e,t,a)=>{e.exports=a.p+"img/f462d2ed6eedca1e4fd9.png"},9618:(e,t,a)=>{e.exports=a.p+"img/6f6f7c09bde970b2e41b.png"},8299:(e,t,a)=>{e.exports=a.p+"img/c75f062dddba6e98fdc6.png"},6136:(e,t,a)=>{e.exports=a.p+"img/26fdc25019c24e87f11a.png"},1947:(e,t,a)=>{e.exports=a.p+"img/ef1b0ea8c4e545d9aadc.png"},8589:(e,t,a)=>{e.exports=a.p+"img/a1d2321024649b9d8f5f.png"},6266:(e,t,a)=>{e.exports=a.p+"img/8b928c3eb136543e573a.png"},2024:(e,t,a)=>{e.exports=a.p+"img/26b5f224d8750119922d.png"},5324:(e,t,a)=>{e.exports=a.p+"img/2429af6d3a5796e3c34b.png"},3177:(e,t,a)=>{e.exports=a.p+"img/07d5e8127645225478b6.png"},9980:(e,t,a)=>{e.exports=a.p+"img/0089a610e6611f679b50.png"},8896:(e,t,a)=>{e.exports=a.p+"img/546abb060a0837550fd1.png"},1034:(e,t,a)=>{e.exports=a.p+"img/6a84ae91f5d985ddc9ee.png"},3523:(e,t,a)=>{e.exports=a.p+"img/46d63299c3420c030b4e.png"},137:(e,t,a)=>{e.exports=a.p+"img/0ac7f8258ec7166dc957.png"},8349:(e,t,a)=>{e.exports=a.p+"img/946aeb948db6313f1d85.png"}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={id:n,exports:{}};return e[n](s,s.exports,a),s.exports}a.m=e,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&!e;)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),a.b=document.baseURI||self.location.href,a.nc=void 0,(()=>{var e=a(3379),t=a.n(e),n=a(7795),i=a.n(n),s=a(569),r=a.n(s),l=a(3565),o=a.n(l),c=a(9216),h=a.n(c),d=a(4589),m=a.n(d),p=a(1402),u={};u.styleTagTransform=m(),u.setAttributes=o(),u.insert=r().bind(null,"head"),u.domAPI=i(),u.insertStyleElement=h(),t()(p.Z,u),p.Z&&p.Z.locals&&p.Z.locals;const g={prairie:"prairie",desert:"desert",arctic:"arctic",mountain:"mountain"};function f(e,t){const a={x:null,y:null};return 0===e&&(a.x=1,a.y=1),e>0&&e<t&&(a.x=1,a.y=e+1),e>=t&&(e%t==0?(a.x=Math.ceil((e+1)/t),a.y=1):(a.x=Math.ceil(e/t),a.y=e%t+1)),a}function b(){const e=Object.keys(g),t=e[Math.floor(Math.random()*e.length)];return g[t]}class v{constructor(){this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]}bindToDOM(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}drawUi(e){this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(e=>this.onNewGameClick(e))),this.saveGameEl.addEventListener("click",(e=>this.onSaveGameClick(e))),this.loadGameEl.addEventListener("click",(e=>this.onLoadGameClick(e))),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(let e=0;e<this.boardSize**2;e+=1){const n=document.createElement("div");n.classList.add("cell","map-tile","map-tile-"+(t=e,a=this.boardSize,0===t?"top-left":t===a-1?"top-right":t>0&&t<a-1?"top":t%a==0&&t!=a*(a-1)?"left":(t+1)%a==0&&t!=Math.pow(a,2)-1?"right":t===a*(a-1)?"bottom-left":t===Math.pow(a,2)-1?"bottom-right":t>a*(a-1)&&t<Math.pow(a,2)-1?"bottom":"center")),n.addEventListener("mouseenter",(e=>this.onCellEnter(e))),n.addEventListener("mouseleave",(e=>this.onCellLeave(e))),n.addEventListener("click",(e=>this.onCellClick(e))),this.boardEl.appendChild(n)}var t,a;this.cells=Array.from(this.boardEl.children)}redrawPositions(e){for(const e of this.cells)e.innerHTML="";for(const a of e){const e=this.boardEl.children[a.position],n=document.createElement("div");n.classList.add("character",a.character.type);const i=document.createElement("div");i.classList.add("health-level");const s=document.createElement("div");s.classList.add("health-level-indicator","health-level-indicator-"+((t=a.character.health)<15?"critical":t<50?"normal":"high")),s.style.width=`${a.character.health}%`,i.appendChild(s),n.appendChild(i),e.appendChild(n)}var t}addCellEnterListener(e){this.cellEnterListeners.push(e)}addCellLeaveListener(e){this.cellLeaveListeners.push(e)}addCellClickListener(e){this.cellClickListeners.push(e)}addNewGameListener(e){this.newGameListeners.push(e)}addSaveGameListener(e){this.saveGameListeners.push(e)}addLoadGameListener(e){this.loadGameListeners.push(e)}onCellEnter(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((e=>e.call(null,t)))}onCellLeave(e){e.preventDefault();const t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((e=>e.call(null,t)))}onCellClick(e){const t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((e=>e.call(null,t)))}onNewGameClick(e){e.preventDefault(),this.newGameListeners.forEach((e=>e.call(null)))}onSaveGameClick(e){e.preventDefault(),this.saveGameListeners.forEach((e=>e.call(null)))}onLoadGameClick(e){e.preventDefault(),this.loadGameListeners.forEach((e=>e.call(null)))}static showError(e){alert(e)}static showMessage(e){alert(e)}selectCell(e,t="yellow"){this.deselectCell(e),this.cells[e].classList.add("selected",`selected-${t}`)}deselectCell(e){if("number"==typeof e){const t=this.cells[e];t.classList.remove(...Array.from(t.classList).filter((e=>e.startsWith("selected"))))}}showCellTooltip(e,t){this.cells[t].title=e}hideCellTooltip(e){this.cells[e].title=""}showDamage(e,t){return new Promise((a=>{const n=this.cells[e],i=document.createElement("span");i.textContent=t,i.classList.add("damage"),n.appendChild(i),i.addEventListener("animationend",(()=>{n.removeChild(i),a()}))}))}setCursor(e){this.boardEl.style.cursor=e}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}class y{constructor(){this.charactersCount=4,this.positions=[],this.currentMove="player",this.level={count:1,area:null},this.selected={cell:null,coordinates:null,index:null,character:null},this.isAvailable={toMove:!1,toAttack:!1},this.types={good:["bowman","swordsman","magician"],bad:["vampire","undead","daemon"]},this.team={good:[],bad:[]}}}class w{constructor(e){this.characters=e}}function*S(e,t){for(;;){const a=Math.floor(Math.random()*(t-1)+1),n=Math.floor(Math.random()*e.length);yield new e[n](a)}}function x(e,t,a){const n=[],i=S(e,t);for(let e=0;e<a;e++){let e=i.next().value;n.push(e)}return new w(n)}class C{constructor(e,t="generic"){if(this.level=e,this.attack=0,this.defence=0,this.health=100,this.type=t,new.target==C)throw new Error("Объект класса Character не может создаваться конструкцией new")}levelUp(){this.level+=1;const e=1.8-(1-this.health/100);this.attack=Math.floor(Math.max(this.attack,this.attack*e)),this.defence=Math.floor(Math.max(this.defence,this.defence*e)),this.health+=80,this.health>100&&(this.health=100)}}class L{constructor(e,t){if(!(e instanceof C))throw new Error("character must be instance of Character or its children");if("number"!=typeof t)throw new Error("position must be a number");this.character=e,this.position=t}}class k extends C{constructor(e){super(e),this.level=e,this.attack=25,this.defence=25,this.moveDist=2,this.attackDist=2,this.type="bowman"}}class E extends C{constructor(e){super(e),this.level=e,this.attack=10,this.defence=10,this.moveDist=1,this.attackDist=4,this.type="daemon"}}class M extends C{constructor(e){super(e),this.level=e,this.attack=10,this.defence=40,this.moveDist=1,this.attackDist=4,this.type="magician"}}class P extends C{constructor(e){super(e),this.level=e,this.attack=40,this.defence=40,this.moveDist=4,this.attackDist=1,this.type="swordsman"}}class $ extends C{constructor(e){super(e),this.level=e,this.attack=40,this.defence=10,this.moveDist=4,this.attackDist=1,this.type="undead"}}class U extends C{constructor(e){super(e),this.level=e,this.attack=25,this.defence=25,this.moveDist=2,this.attackDist=2,this.type="vampire"}}const R="auto",T="pointer",G="crosshair",D="not-allowed",z=new v;z.bindToDOM(document.querySelector("#game-container"));const A=new class{constructor(e){this.storage=e}save(e){this.storage.setItem("state",JSON.stringify(e))}load(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state")}}}(localStorage),I=new class{constructor(e,t){this.gamePlay=e,this.stateService=t,this.gameState=new y,this.goodtypes=[k,P,M],this.badtypes=[U,$,E],this.curCellindx=null}init(){this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGameClick.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGameClick.bind(this)),this.begin()}begin(){this.gameState.level.area=b(),this.createTeams(),this.drawBoard()}onNewGameClick(){this.blockBoard(),this.gameState=new y,this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.currentCellIdx=null,this.gameState.level.area=b(),this.createTeams(),this.drawBoard()}onSaveGameClick(){this.stateService.save(this.gameState)}onLoadGameClick(){if(this.stateService.storage.length>0){const e=this.stateService.load();this.gameState=new y,this.gameState.level.area=e.level.area,this.gameState.level.count=e.level.count,this.gameState.charactersCount=e.charactersCount,this.gameState.positions=e.positions,this.gameState.currentMove=e.currentMove,this.gameState.selected.cell=e.selected.cell,this.gameState.selected.index=e.selected.index,this.gameState.selected.character=e.selected.character,this.gameState.selected.coordinates=e.selected.coordinates,this.gameState.isAvailable.toMove=e.isAvailable.toMove,this.gameState.isAvailable.toAttack=e.isAvailable.toAttack;const t=[],a=[];this.gameState.positions.forEach((e=>{Object.setPrototypeOf(e.character,C.prototype),this.gameState.types.good.some((t=>t===e.character.type))&&t.push(e.character),this.gameState.types.bad.some((t=>t===e.character.type))&&a.push(e.character)})),this.gameState.team.good=new w(t),this.gameState.team.bad=new w(a),this.drawBoard()}}createTeams(){if(1===this.gameState.level.count)this.gameState.team.good=x(this.goodtypes,this.gameState.level.count,this.gameState.charactersCount),this.gameState.team.bad=x(this.badtypes,this.gameState.level.count,this.gameState.charactersCount);else{const e=this.numberOfCharactersToAdd(this.gameState.team.good.characters),t=this.numberOfCharactersToAdd(this.gameState.team.bad.characters),a=[],n=[];for(let t=1;t<=e;t+=1)a.push(S(this.goodtypes,this.gameState.level.count).next().value);for(let e=1;e<=t;e+=1)n.push(S(this.badtypes,this.gameState.level.count).next().value);a.forEach((e=>this.gameState.team.good.characters.push(e))),n.forEach((e=>this.gameState.team.bad.characters.push(e)))}const e=function*(e){const t=[],a=new Set;for(let e=0;e<64;e+=1)0!==e&&1!==e&&e%8!=0&&e%8!=1||t.push(e);for(;a.size<e;)a.add(t[Math.floor(Math.random()*t.length)]);for(const e of a)yield e}(this.gameState.charactersCount),t=function*(e){const t=[],a=new Set;for(let e=0;e<64;e+=1)6!==e&&7!==e&&(e+2)%8!=0&&(e+1)%8!=0||t.push(e);for(;a.size<e;)a.add(t[Math.floor(Math.random()*t.length)]);for(const e of a)yield e}(this.gameState.charactersCount);this.gameState.team.good.characters.forEach((t=>{this.gameState.positions.push(new L(t,e.next().value))})),this.gameState.team.bad.characters.forEach((e=>{this.gameState.positions.push(new L(e,t.next().value))}))}drawBoard(){this.gamePlay.drawUi(this.gameState.level.area),this.gamePlay.redrawPositions(this.gameState.positions)}async onCellClick(e){const t=this.gamePlay.cells[e],a=t.firstChild;let n,i,s;if(a&&(n=this.gameState.team.bad.characters.some((e=>a.classList.contains(e.type)))),this.gameState.selected.cell){let t=this.gameState.selected.coordinates,a=this.gameState.selected.character.attackDist,n=this.gameState.selected.character.moveDist;i=this.availableTo(e,t,n),s=this.availableTo(e,t,a)}if(a&&!n&&(this.gamePlay.deselectCell(this.gameState.selected.index),this.gamePlay.selectCell(e),this.gameState.selected={cell:t,index:e,character:this.findCharacter(e),coordinates:f(e,this.gamePlay.boardSize)}),!a&&i&&(this.gamePlay.deselectCell(this.gameState.selected.index),this.gamePlay.deselectCell(this.currentCellIdx),this.moveToAnEmptyCell(e),"player"===this.gameState.currentMove&&await this.badMove()),a&&n)if(s){this.gamePlay.deselectCell(this.gameState.selected.index),this.gamePlay.deselectCell(this.currentCellIdx);const t=this.findCharacter(e);if(await this.attack(this.gameState.selected.character,t,e),0===this.gameState.team.bad.characters.length)return void this.gameLevelUp();"player"===this.gameState.currentMove&&await this.badMove()}else v.showError("Этот игрок противника недоступен для атаки!")}onCellEnter(e){"number"!=typeof this.currentCellIdx||this.gamePlay.cells[this.currentCellIdx].classList.contains("selected-yellow")||this.gamePlay.deselectCell(this.currentCellIdx);const t=this.gamePlay.cells[e].firstChild;let a,n,i;var s;if(t&&(this.gamePlay.setCursor(T),this.gamePlay.showCellTooltip((s=this.findCharacter(e),`${String.fromCodePoint(127894)+s.level} ${String.fromCodePoint(9876)+s.attack} ${String.fromCodePoint(128737)+s.defence} ${String.fromCodePoint(10084)+s.health}`),e),a=this.gameState.types.bad.some((e=>t.classList.contains(e)))),this.gameState.selected.cell){let t=this.gameState.selected.coordinates,a=this.gameState.selected.character.attackDist,s=this.gameState.selected.character.moveDist;n=this.availableTo(e,t,s),i=this.availableTo(e,t,a)}this.gameState.selected.cell&&(n?t||(this.gamePlay.setCursor(T),this.gamePlay.selectCell(e,"green")):this.gamePlay.setCursor(D),t&&a&&(i?(this.gamePlay.setCursor(G),this.gamePlay.selectCell(e,"red")):this.gamePlay.setCursor(D))),t&&!a&&this.gamePlay.setCursor(T),this.currentCellIdx=e}onCellLeave(e){this.gamePlay.setCursor(R),this.gamePlay.hideCellTooltip(e)}numberOfCharactersToAdd(e){return this.gameState.charactersCount-e.length}async attack(e,t,a){const n=Math.floor(Math.max(e.attack-t.defence,.2*e.attack));t.health-=n,await this.gamePlay.showDamage(a,n),this.checkDeath(t),this.gamePlay.redrawPositions(this.gameState.positions),this.clearSelectedCell()}gameLevelUp(){if("enemy"===this.gameState.currentMove)return alert('Вы проиграли.\nЧтобы начать новую игру нажмите "New game".'),void this.blockBoard();this.gameState.level.count+=1,this.gameState.level.count>4?(this.blockBoard(),alert("Поздравляю! Вы победили!")):(alert(`Уровень пройден! Переход на уровень ${this.gameState.level.count}`),this.gameState.team.good.characters.forEach((e=>e.levelUp())),this.gameState.charactersCount+=1,this.gameState.positions=[],this.gameState.level.area=b(),this.createTeams(),this.drawBoard())}checkDeath(e){if(e.health<=0){let e=this.gameState.positions.findIndex((e=>e.character.health<=0));this.gameState.positions.splice(e,1),e=this.gameState.team.bad.characters.findIndex((e=>e.health<=0)),this.gameState.team.bad.characters.splice(e,1)}}clearSelectedCell(){Object.assign(this.gameState,{selectedCellIndex:null,selectedCharacter:null,selectedCellCoordinates:null,isAvailableToMove:!1,isAvailableToAttack:!1})}moveToAnEmptyCell(e){const t=this.gameState.positions.findIndex((e=>e.position===this.gameState.selected.index));this.gameState.positions[t].position=e,this.gamePlay.redrawPositions(this.gameState.positions),this.clearSelectedCell()}findCharacter(e){const t=this.gameState.positions.findIndex((t=>t.position===e));return this.gameState.positions[t].character}blockBoard(){this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.setCursor(R)}async badMove(){this.gameState.currentMove="enemy";const{good:e}=this.gameState.team,{bad:t}=this.gameState.team;let a;const n=[];this.gameState.team.good=t,this.gameState.team.bad=e,this.gameState.positions.forEach((e=>{this.gameState.team.bad.characters.some((t=>t.type===e.character.type))&&n.push(e.position)}));for(const i of this.gameState.team.good.characters)if("enemy"===this.gameState.currentMove){const s=this.gameState.positions.findIndex((e=>e.character===i));await this.onCellClick(this.gameState.positions[s].position);for(const i of n){let n=this.gameState.selected.coordinates,s=this.gameState.selected.character.attackDist;if(a=this.availableTo(i,n,s),a){await this.onCellClick(i),this.gameState.currentMove="player",this.gameState.team.good=e,this.gameState.team.bad=t;break}}}if("enemy"===this.gameState.currentMove){let a=this.gameState.selected.coordinates,n=this.gameState.selected.character.moveDist;await this.onCellClick(function(e,t,a){const n={x:null,y:null};let i,s;do{n.x=Math.floor(Math.random()*(2*t+1))+(e.x-t),n.y=Math.floor(Math.random()*(2*t+1))+(e.y-t),i=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y)}while(n.x===e.x&&n.y===e.y||n.x>a||n.y>a||n.x<=0||n.y<=0||i>t||s>t||i!==s&&0!==i&&0!==s);return function(e,t){return(e.x-1)*t-1+e.y}(n,a)}(a,n,this.gamePlay.boardSize)),this.gameState.currentMove="player",this.gameState.team.good=e,this.gameState.team.bad=t}}availableTo(e,t,a){const n=f(e,this.gamePlay.boardSize),i=Math.abs(n.x-t.x),s=Math.abs(n.y-t.y);if(i<=a&&s<=a&&(i===s||0===i||0===s))return!0}}(z,A);I.init()})()})();